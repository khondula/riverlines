---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{python}
from PIL import Image
from skimage import io
io.use_plugin('pil')
from skimage.morphology import skeletonize
from skimage import data
import matplotlib.pyplot as plt
from skimage.util import invert

# Invert the horse image
image = io.imread('testriver.tif')

# perform skeletonization
skeleton = skeletonize(image)

io.imsave('rivskeleton.tif', skeleton)

# display results
fig, axes = plt.subplots(nrows=1, ncols=2, figsize=(8, 4),
                         sharex=True, sharey=True)

ax = axes.ravel()

ax[0].imshow(image, cmap=plt.cm.gray)
ax[0].axis('off')
ax[0].set_title('original', fontsize=20)

ax[1].imshow(skeleton, cmap=plt.cm.gray)
ax[1].axis('off')
ax[1].set_title('skeleton', fontsize=20)

fig.tight_layout()
plt.show()
```

```{r}
library(terra)
library(sf)
myskel <- terra::rast('rivskeleton.tif')
plot(myskel)
myskel <- terra::classify(myskel, matrix(c(0, NA), nrow = 1))
plot(myskel)
myl <- terra::as.polygons(myskel) %>% st_as_sf() %>% dplyr::filter(rivskeleton == 255)
plot(myl)

myls <- myl %>% st_cast(to = "POLYGON") %>% dplyr::filter(rivskeleton == 255)
myls %>% dplyr::mutate(area = st_area(myls)) %>% dplyr::arrange(-area) %>% head(1000) %>% plot()
myls_combine <- myls %>% st_combine()
myline_sf <- myls_combine %>% st_union() %>% st_cast(to = "MULTILINESTRING") %>% st_as_sf()
plot(myline_sf)
st_sample(myline_sf, 5)
# myls <- myls %>% dplyr::mutate(id = 1:nrow(myls))

library(ggplot2)
ggplot() +
  geom_sf(data = myls, aes(col = id))

plot(myls)
myl %>% st_as_sf() %>% st_combine() %>% st_union()
```

